<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Document</title>
  </head>
  <body>
    <header class="header">
      <h1>CRUD API REST FETCH</h1>
    </header>
    <section class="crud">
      <article>
        <h2 class="crud-title">Add Superhero üê±‚Äçüèç</h2>
        <form class="crud-form">
          <input type="text" name="name" placeholder="Nombre" required />
          <input type="text" name="type" placeholder="Tipo" required />
          <input type="submit" value="Enviar" />
          <input type="hidden" name="id" />
        </form>
      </article>
      <article>
        <h2>Superheros</h2>
        <table class="crud-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </article>
    </section>
    <template id="crud-template">
      <tr>
        <td class="name"></td>
        <td class="type"></td>
        <td>
          <button class="edit">Editar</button>
          <button class="delete">Eliminar</button>
        </td>
      </tr>
    </template>
    <script>
      const d = document,
        $table = d.querySelector('.crud-table'),
        $form = d.querySelector('.crud-form'),
        $title = d.querySelector('crud-title'),
        $fragment = d.createDocumentFragment(),
        $template = d.getElementById('crud-template').content;

        async function getAll(){
          try {
            let res = await fetch('http://localhost:3000/superheros');
            let json = await res.json();
            if (!res.ok) throw { status: res.status, statusText: res.statusText };
            json.forEach((value) => {
                $template.querySelector('.name').textContent = value.name;
                $template.querySelector('.type').textContent = value.type;
                $template.querySelector('.edit').dataset.id = value.id;
                $template.querySelector('.edit').dataset.name = value.name;
                $template.querySelector('.edit').dataset.type = value.type;
                $template.querySelector('.delete').dataset.id = value.id;
                $template.querySelector('.delete').dataset.name = value.name;
                let $clone = d.importNode($template, true);
                $fragment.appendChild($clone);   
              });
              $table.querySelector('tbody').appendChild($fragment);    
          } catch (err) {
             let message = err.statusText || "Ocurri√≥ un error!";
             $table.insertAdjacentHTML('afterend', `<span>Error: ${err.status}: ${message}</span>`); 
          }
        }

        const create = async () => {
          try {
            const options = {
              method: 'POST',
              headers: {'Content Type': 'application/json'},
              body: JSON.stringify({
              name: $form.name.value,
              type: $form.type.value
              })
            };
            let res = await fetch('http://localhost:3000/superheros', options);
            console.log(res);
            
          } catch (err) {
             let message = err.statusText || "Ocurri√≥ un error!";
             $form.insertAdjacentHTML('afterend', `<span>Error: ${err.status}: ${message}</span>`);
          }
        }

        d.addEventListener("DOMContentLoaded", getAll());
        d.addEventListener("submit", (e) => {
          e.preventDefault();
          if (e.target === $form) {
            if (!e.target.id.value) {
              console.log('in');
              create();
            }
          }
        })

        
    </script>
  </body>
</html>
